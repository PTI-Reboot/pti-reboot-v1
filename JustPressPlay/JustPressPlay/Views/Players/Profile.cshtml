@{
    ViewBag.Title = "Profile";
}

@model JustPressPlay.ViewModels.ProfileViewModel

<div id="headerSection">
    <div class="row">

        <div class="large-2 columns">
            <div id="mainImageContainer">
                @if (!@Model.Image.IsEmpty())
                {
                    <img src="@Url.Content(@Model.Image)" />
                }
                else
                {
                    <img src="@Url.Content("~/Content/Images/Jpp/defaultProfileAvatar.png")" />
                }
            </div>
            @if (@Model.FriendStatus == JustPressPlay.ViewModels.ProfileViewModel.FriendshipStatus.SameUser)
            {
                <a href="#" class="button secondary radius expand tiny">Edit Profile</a>
            }
            else if (@Model.FriendStatus == JustPressPlay.ViewModels.ProfileViewModel.FriendshipStatus.Friends)
            {
				<a href="#" class="button secondary radius expand tiny">You Are Friends</a>
                using (Html.BeginForm("RemoveFriend", "Players", FormMethod.Post))
                {
					<input type="hidden" name="id" value="@Model.ID" />
					<input type="submit" class="button secondary radius expand tiny" value="TESTING - REMOVE FRIEND" />
                }
            }
            else if (@Model.FriendStatus == JustPressPlay.ViewModels.ProfileViewModel.FriendshipStatus.NotFriends)
            {
                <a href="#" class="button secondary radius expand tiny">Send Friend Request</a>
                using (Html.BeginForm("AddFriend", "Players", FormMethod.Post))
                {
					<input type="hidden" name="id" value="@Model.ID" />
					<input type="submit" class="button secondary radius expand tiny" value="TESTING - ADD FRIEND" />
                }
            }
            else if (@Model.FriendStatus == JustPressPlay.ViewModels.ProfileViewModel.FriendshipStatus.PendingRequestSent)
            {
				<a href="#" class="button secondary radius expand tiny disabled">Friend Request Sent</a>
            }
            else if (@Model.FriendStatus == JustPressPlay.ViewModels.ProfileViewModel.FriendshipStatus.PendingRequestReceived)
            {
				<a href="#" class="button secondary radius expand tiny">Pending Friend Request - Respond?</a>
            }

            <a href="#" class="button secondary radius expand tiny">Share this Page</a>
            
        </div>
        <div class="large-6 columns">
            <h1>@Model.DisplayName</h1>
            <h4>(@Model.FirstName @Model.LastName)</h4>
            <h2>@Model.SixWordBio</h2>
            <p>@Model.FullBio</p>
        </div>
        <div class="large-4 columns">
            <div id="profileQuad"></div>
        </div>


    </div>
</div>

<div id="lowerBody">
        <div class="row">
            <div class="large-8 columns">
                
                @if (@WebSecurity.CurrentUserId == @Model.ID)
                {
                    <h3>Your Timeline</h3>
                }
                else
                {
                    <h3>@Model.DisplayName's Timeline</h3>
                }

                <div class="fullscreen-image" data-bind="template: { name: 'person-template', data: buyer }"></div>

                <div class="earningFeed">
                    <div data-bind="template: { name: 'earning-wide-template', foreach: earnings }">
                    </div>

                    <div class="bottom">
                        <div class="spinner" data-bind="visible: isLoading"></div>
                        <div class="endOfFeed" data-bind="visible: atEnd">
                            <h6>End of Feed</h6>
                        </div>
                        <div data-bind="visible: isEmpty">
                            <p>There's nothing here!</p>
                        </div>
                    </div>
                </div>

            </div>

            <div id="lowerBodySidebar" class="large-4 columns">
                @*
                @if (@WebSecurity.CurrentUserId == @Model.ID)
                {
                    <h3>Your Collections</h3>
                }
                else
                {
                    <h3>@Model.DisplayName's Collections</h3>
                }
                *@

                <div class="panel">
                    <div id="profileQuestList"></div>
                </div>
                    
                <div class="panel">
                    <div id="profileAchievementList"></div>
                </div>
                    
                <div class="panel">
                    <div id="profileFriendsList"></div>
                </div>

                

                <footer class="small">

                    @{ Html.RenderPartial("_Footer"); }

                </footer>

            </div> <!-- END lowerBodySidebar -->

        </div>
    </div>

@{ Html.RenderPartial("_EarningList"); }
<script src="@Url.Content("~/Content/js/plugin/jquery.jppquad.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/js/plugin/jquery.jppimagelist.js")" type="text/javascript"></script>
<script>


    var settings = {
        playerID: '@Model.ID'
    };
    ko.applyBindings(new EarningListViewModel(settings));

    $(document).ready(function () {

        $('#profileQuad').jppquad({
            thresholds: {
                0: 25,
                1: 50,
                2: 75
            },
            maxThreshold: 100,
            createPoints: '@Model.PointsCreate',
            learnPoints: '@Model.PointsLearn',
            explorePoints: '@Model.PointsExplore',
            socializePoints: '@Model.PointsSocialize'
        });

        var url = '@Request.Url.GetLeftPart(UriPartial.Authority)';
      
        /*
        $('body').on('keypress', 'form.write-comment', function (e) {
            
            // Submit when enter key is pressed without shift key
            if (e.keyCode == 13) {
                e.preventDefault(); // prevent native submit

                // Submit if shift key isn't currently held
                if (!e.shiftKey) {
                    $(this).ajaxSubmit({
                        clearForm: true,
                        delegation: true,
                        success: function (responseObj) {
                            // If comment was successfully added, add it in the view
                            if (responseObj.Success) {

                            }
                        }
                    })
                }
            }
        });
        */


        @*
        $('#profileQuestList').jppimagelist({
            baseURL: url,
            userID: '@Model.ID',
            questList: true,
            displayListHeading: true,
            includeText: false,
            completedQuests: true,
            scroll: true
        });

        $('#profileAchievementList').jppimagelist({
            baseURL: url,
            userID: '@Model.ID',
            achievementList: true,
            displayListHeading: true,
            includeText: false,
            earned: true,
            scroll: true
        });

        $('#profileFriendsList').jppimagelist({
            baseURL: url,
            userID: '@Model.ID',
            playerList: true,
            displayListHeading: true,
            includeText: false,
            friendsWith: true,
            scroll: true
        });
        *@

    }); // End document ready



</script>